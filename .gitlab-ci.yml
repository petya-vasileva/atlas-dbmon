image: petya/ords-dbmon:latest

stages:
  - build
  - build_application_docker_image
  - redeploy

cache:
  paths:
    - node_modules/

install_dependencies:
  stage: build
  script:
    - npm install
  artifacts:
    paths:
      - node_modules/
      
build_application_docker_image:
  stage: build_application_docker_image
  tags:
   - docker-image-build
  script: 
   - "echo building $CI_REGISTRY_IMAGE:runner" 
  variables:
   TO: $CI_REGISTRY_IMAGE:runner 

      
redeploy:
  stage: redeploy
  only:
  - master
  image: gitlab-registry.cern.ch/paas-tools/openshift-client:latest
  script: "oc import-image $IMAGE_NAME  --server=$SERVER --namespace $NAMESPACE --all --token=$IMAGE_IMPORT_TOKEN"

